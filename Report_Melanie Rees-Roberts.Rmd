---
title: "Report_Melanie Rees-Roberts"
author: "Melanie Rees-Roberts"
date: "2024-11-14"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Title: Understanding health and wealth in Scottish Council areas

### Background
# Over the last 100 years, life expectancy in the UK has increased significantly with advances in living standards and advancing healthcare. However, over the last 10 years this has stalled and even declined in some instances alongside significant inequalities arising across the country. In Scotland, disparities in life expectancy are evident where the most deprived exhibit approximately 10 years difference in life expectancy compared to their more affluent neighbourhoods. In recent years, the cost of living crisis has also impacted on peoples health and wellbeing but the extent to which this has impacts on different income levels is unknown and thereafter how this links to health. The extent to which people feel able to manage their own money may act as a useful proxy measure for financial stress within a cost of living crisis regardless of income levels and be a useful indicator for health status.

## Research questions
# 1. What is the variation in health and mental health across different Scottish council areas?
# 2. How is population income associated with the perception of being able to manage money well?
# 3. How does the ability to manage money well impact on health and mental health in Scotland?

### Packages and libraries
# For this work, the following packages and libraries were used:

#install.packages("tidyverse")

```{r - packages and libraries}

library(tidyverse)
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)

```

###Data acquisition
# In this work, we used the datasets in Table 1 below. These data were downloaded from https://scotland.shinyapps.io/ScotPHO_profiles_tool/ in a single file and then tidy datasets created for analysis. 

#Import the data and create tidy datasets as each variable is listed in a single column with the name of the indicator in the column 'indicator'

```{r - read in and tidy healthy life expectancy data}

Data <- read_csv("ScotPHO_data.csv")
glimpse(Data) 

```
### Data cleaning and preparation
##Dataset 1 - Healthy life expectancy.
# Create tidy data with helathy life expectancy for males and females
```{r - tidy healthy life expectancy data}
hle <- Data %>% 
  filter(grepl('Healthy', indicator)) %>% 
  select(area_code,area_name,indicator,measure,upper_confidence_interval,lower_confidence_interval) %>% 
  rename(sex = indicator,
        hle = measure) %>% 
  mutate(sex = gsub('Healthy life expectancy, females','0', sex,)) %>% 
  mutate(sex = gsub('Healthy life expectancy, males','1', sex,))    
    
head(hle)
glimpse(hle)
```
# We now need to combine males and females to create a single mean healthy life expectancy value for each Council area

```{r}
mean_hle <- hle %>% 
  group_by(area_code) %>% 
  mutate(mean_hle = mean(hle)) 
  select
```

# We have duplicate mean healthy life expectancy values, so now we need to slice the rows containing sex = 0 and remove the column sex
```{r}
mean_hle1 <- mean_hle %>% 
  filter(sex != 1) %>% 
  select(area_code, area_name, mean_hle)

head(mean_hle1)

```
##Dataset 2 - Population income deprived
```{r - tidy population income deprived data}

pid <- Data  %>%  
  drop_na()

pid <- pid %>% 
  select(area_code,numerator,measure) %>% 
  rename(population = numerator,
        pid = measure) 
    
```
##Dataset 3 - Mental health score deprived
```{r - tidy mental health score  data}
mental <- Data %>% 
  filter(grepl('Mental', indicator)) %>% 
  select(area_code,measure) %>% 
  rename(mental_score = measure)
         
```

##Dataset 4 - Households managing financially well
```{r - tidy households managing financially well data}
finance <- Data %>% 
  filter(grepl('Households', indicator)) %>% 
  select(area_code,measure) %>% 
  rename(finance = measure)

```

##Combine data into a single table named data_final.

```{r}
data_final <- inner_join(mean_hle1, pid, by = 'area_code')

data_final <- inner_join(data_final, mental, by = 'area_code') 

data_final <- inner_join(data_final, finance, by = 'area_code') 
  
```

### Data analysis and visualisation

## 1. What is the variation in health and mental health across different Scottish council areas?

```{r}
data_final %>% 
  ggplot() +
  geom_col(aes(x = reorder(area_name, pid), y = mean_hle)) +
  geom_point(aes(x=area_name, y = mental_score)) +
  coord_cartesian(ylim = c(40, NA)) +
  ggtitle("          Health and mental health across Scottish Councils") +
  labs(x="Area name by increasing % of population income deprived", 
       y = "Mean Healthy life expectancy in years (bars)
            Mental Health Score  (dots)") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
 
  
```

## 2. How is population income associated with the perception of being able to manage money well?
```{r code for Research Q 2}
  data_final %>% 
  ggplot(aes(x = pid, y = finance)) +
  geom_point() +
  geom_smooth(method = lm) +
  ggtitle("Correlation of percentage population income deprived with ability 
          of population to manage their own money for Scottish Council areas") +
  labs(x="% of population that are income deprived", 
       y = "Ability to manage their own money effectively (score)") + 
  coord_cartesian(ylim = c(0, NA)) 
```


## 3. How does the ability to manage money well impact on health and mental health in Scotland?
```{r}

```


### Discussion

##Limitations
#different years of data